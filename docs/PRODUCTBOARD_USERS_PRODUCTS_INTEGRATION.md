# ProductBoard Users and Products Integration

This document outlines the integration of ProductBoard users and products into the PB-to-ADO mapping system.

## Overview

The integration adds support for:

1. Fetching and storing ProductBoard users who are owners of features
2. Fetching and storing ProductBoard products
3. Using this data in the mapping UI to create more precise mappings

## Database Schema

Two new tables have been added to the Supabase database:

### productboard_users

```sql
CREATE TABLE productboard_users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  productboard_id TEXT,
  email TEXT NOT NULL,
  name TEXT,
  role TEXT,
  workspace_id TEXT,
  metadata JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(email, workspace_id)
);
```

### productboard_products

```sql
CREATE TABLE productboard_products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  productboard_id TEXT NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  workspace_id TEXT,
  metadata JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(productboard_id, workspace_id)
);
```

## Data Synchronization

The `pb-connect` module has been enhanced to:

1. Fetch products from the ProductBoard API using the `/products` endpoint
2. Extract users who are owners of features
3. Transform and store this data in the Supabase database

### API Module Updates

The `api.js` module now includes:

- `fetchProducts()` - Fetches products from ProductBoard with pagination
- `extractUsersFromFeatures()` - Extracts unique users who are owners of features

### Transformer Module Updates

The `transformer.js` module now includes:

- `transformProductForDb()` - Transforms raw product data for database storage
- `transformUserForDb()` - Transforms raw user data for database storage

### Database Module Updates

The `db.js` module now includes:

- `upsertProducts()` - Upserts products into the database
- `upsertUsers()` - Upserts users into the database

### Sync Module Updates

The `sync.js` module has been updated to:

1. Track products and users in the stats object
2. Fetch products from ProductBoard
3. Extract users from features
4. Transform and store both in the database

## Frontend Integration

### React Hooks

Two new hooks have been created:

1. `useUsers()` - Fetches and manages ProductBoard users
2. `useProducts()` - Fetches and manages ProductBoard products

### UI Integration

The `UserTeamMappingTab` component has been updated to:

1. Use the new hooks to fetch users and products
2. Display real product data in the product dropdown
3. Log the data from hooks for debugging purposes

## Enhanced Mapping Capabilities

With this integration, the mapping system now supports:

1. For epics: Mapping initiatives from ProductBoard to business units in Azure DevOps
2. For features: Mapping components from ProductBoard to products in Azure DevOps
3. For stories: Mapping users, products, and components from ProductBoard to teams in Azure DevOps

This provides more precise control over how items are mapped between the two systems.

## Future Enhancements

Potential future enhancements include:

1. Adding UI for managing ProductBoard products and users
2. Implementing more sophisticated mapping suggestions based on product and user data
3. Enhancing the sync process to capture more metadata about products and users
